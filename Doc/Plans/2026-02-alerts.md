Alerts and asides
===============================================================================

## Context

GFM alerts (`> [!NOTE]`, `> [!TIP]`, etc.) and DocC-style asides
(`> Note: ...`, `> Tip: ...`) are two conventions for callout blocks in
markdown. Both are rendered as plain `<blockquote>` today. This change detects
both syntaxes in up mode and renders them as visually distinct callouts with
colored borders, icons, and titles.


## Detection

Two syntaxes, checked in order inside `visitBlockQuote`:

1. **GFM alerts** — First paragraph's first `Text` child matches `[!NOTE]`,
   `[!TIP]`, `[!IMPORTANT]`, `[!WARNING]`, or `[!CAUTION]`. Five types only.
   Detection uses `hasPrefix("[!")` + switch on the five known tags (no regex).
   Following GitHub's behavior: any trailing text on the same line as the
   `[!TYPE]` tag is discarded. Content starts on the next line.

2. **DocC asides** — Use swift-markdown's
   `Aside(blockQuote, tagRequirement: .requireAnyLengthTag)`. If it returns
   non-nil AND the kind matches a known `Aside.Kind` from `allCases`, treat it
   as an alert. All 24 predefined kinds are accepted.

GFM is checked first because it's more specific (the `[!...]` pattern is
unambiguous). DocC is checked second and validated against the known-kinds list
to avoid false positives on arbitrary `Word:` prefixes.


## Visual categories

Five visual styles. Every alert kind maps to one:

| Category  | Color  | GFM type  | DocC kinds                                                |
| --------- | ------ | --------- | --------------------------------------------------------- |
| note      | blue   | NOTE      | Note, Remark                                              |
| tip       | green  | TIP       | Tip, Experiment                                           |
| important | purple | IMPORTANT | Important, Attention                                      |
| warning   | amber  | WARNING   | Warning, Precondition, Postcondition, Requires, Invariant |
| caution   | red    | CAUTION   | Bug, Throws                                               |

All remaining DocC kinds (Author, Authors, Complexity, Copyright, Date,
MutatingVariant, NonMutatingVariant, Since, SeeAlso, ToDo, Version) map to
**note** (blue).


## Title text

- **GFM alerts** — Title is the type name: "Note", "Tip", "Important",
  "Warning", "Caution".
- **DocC asides** — Title is the `Aside.Kind` raw value as-is. For example,
  `> Precondition:` renders with the title "Precondition" (not "Warning"),
  `> See Also:` renders as "See Also", etc. This preserves the author's
  original intent.


## HTML output

```html
<blockquote class="alert alert-note">
  <p class="alert-title"><svg …/>Note</p>
  <p>Content paragraph…</p>
</blockquote>
```

Using `<blockquote>` (not `<div>`) preserves base blockquote styles. The
`.alert` class overrides `color` back to `--text-color` (base blockquotes use
the muted `--blockquote-color`).


## Files to modify

### `Core/Sources/Core/Rendering/UpHTMLVisitor.swift`

Replace `visitBlockQuote` with alert-aware logic:

```
visitBlockQuote(blockQuote):
  if let (category, title) = detectGFMAlert(blockQuote):
    emitAlert(category, title, children: blockQuote, skipFirstParagraph: true or strip tag)
  else if let (category, title, content) = detectDocCAlert(blockQuote):
    emitAlert(category, title, children: content)
  else:
    // existing plain blockquote path
```

**GFM tag stripping**: Following GitHub's behavior, the entire first paragraph
is skipped — the `[!TYPE]` tag and any trailing text on the same line are
discarded. Content comes from the remaining block children, visited via
`visit(child)`.

**DocC tag stripping**: `Aside.content` already has the tag removed. Visit each
block in `aside.content` via `visit(block)`.

**Helpers to add** (private, same file):

- `detectGFMAlert(_:) -> (AlertCategory, String)?` — regex/string match on
  first text node
- `detectDocCAlert(_:) -> (AlertCategory, String, [BlockMarkup])?` — uses
  `Aside`, validates kind, maps to category
- `emitAlertTitle(_:_:)` — emits the `<p class="alert-title">` with inline SVG
  and title text
- `AlertCategory` enum — `note, tip, important, warning, caution`; has SVG icon
  string property


### `Core/Sources/Core/Resources/mud-up.css`

Add after the existing blockquote rules (~line 135):

- `.alert` base: override `color` to `--text-color`, adjust padding
- `.alert-title`: flexbox row, font-weight 600, icon sizing, margin
- `.alert-note`, `.alert-tip`, `.alert-important`, `.alert-warning`,
  `.alert-caution`: each sets `border-left-color` and `.alert-title` color
- Alert colors defined as CSS custom properties (e.g. `--alert-note-border`,
  `--alert-note-title`) with light defaults in `.alert` and dark overrides
  inside `@media (prefers-color-scheme: dark)`, following the same pattern as
  theme files. Themes can override any `--alert-*` variable in their own
  `:root` blocks to customize alert colors, though none do initially.


## Files NOT modified

- **Theme CSS files** — No changes initially; themes can optionally override
  `--alert-*` variables in the future.
- **`DownHTMLVisitor.swift`** — Down mode shows raw source; no changes.
- **`MarkdownParser.swift`** — No parser changes; detection is in the visitor.
- **`HTMLTemplate.swift`** — No changes; CSS is already bundled.
- **`mud.css`** — Alert styles are up-mode-only.


## Icons

Five small inline SVGs (one per category), emitted in the title paragraph. Kept
as static strings in the Swift source. Exact GitHub Octicon SVGs (MIT
licensed), small enough to inline without a resource file.


## Verification

Test document: `Doc/Examples/alerts.md` — covers all supported alert syntaxes,
rich content, and plain blockquotes that must not trigger alert styling.

Summary of test cases:

```markdown
> [!NOTE]
> GFM note

> [!TIP]
> GFM tip with **bold** and `code`

> [!IMPORTANT]
> GFM important

> [!WARNING]
> GFM warning

> [!CAUTION]
> GFM caution

> Note: DocC note

> Tip: DocC tip

> Warning: DocC warning with
> multiple lines

> Bug: DocC bug (should render as caution)

> This is a regular blockquote with no alert tag.
```

1. Open in Mud — verify each alert has correct colored border, icon, title, and
   content. Verify the plain blockquote is unchanged.
2. Toggle lighting — verify colors adapt to light and dark modes.
3. Toggle themes — verify alerts look consistent across all four themes.
4. Check down mode — verify raw source shows unchanged.
5. Test CLI output (`mud -u`) — verify alert HTML appears in CLI output.


-------------------------------------------------------------------------------


## Step 1 — `AlertCategory` enum and icon strings

Add to `Core/Sources/Core/Rendering/UpHTMLVisitor.swift`, below the struct as a
private type (or inside it as a nested private enum):

```swift
private enum AlertCategory: String {
    case note, tip, important, warning, caution

    var cssClass: String { "alert-\(rawValue)" }

    var icon: String { /* static SVG string per case */ }

    var title: String { rawValue.capitalized }
}
```

Octicon SVGs (16×16, `fill="currentColor"`, `aria-hidden="true"`):

- note → `octicon-info`
- tip → `octicon-light-bulb`
- important → `octicon-report`
- warning → `octicon-alert`
- caution → `octicon-stop`


## Step 2 — GFM detection

Add a private helper:

```
detectGFMAlert(_ blockQuote: BlockQuote) -> (AlertCategory, String)?
```

Logic:

1. Get first child paragraph.
2. Get its first inline child as `Text`.
3. Match text against `[!NOTE]`, `[!TIP]`, `[!IMPORTANT]`, `[!WARNING]`,
   `[!CAUTION]` using `hasPrefix("[!")` then switch.
4. Return `(category, titleString)` or nil.

Per GitHub behavior: the entire first paragraph is discarded (tag + any
trailing text on the tag line).


## Step 3 — DocC detection

Add a private helper:

```
detectDocCAlert(_ blockQuote: BlockQuote) -> (AlertCategory, String, [BlockMarkup])?
```

Logic:

1. `guard let aside = Aside(blockQuote, tagRequirement: .requireAnyLengthTag)`
2. Validate `aside.kind` is in `Aside.Kind.allCases` (rejects custom tags).
3. Map `aside.kind` to `AlertCategory` per the table in the design doc.
4. Title = `aside.kind.displayName` (human-readable: "See Also", "To Do", etc.)
5. Return `(category, title, aside.content)`.


## Step 4 — Alert HTML emission

Add two private helpers:

```
emitAlertOpen(_ category: AlertCategory)
emitAlertTitle(_ category: AlertCategory, _ title: String)
```

`emitAlertOpen` emits `<blockquote class="alert alert-{category}">`.
`emitAlertTitle` emits `<p class="alert-title">{svg}{title}</p>`.


## Step 5 — Replace `visitBlockQuote`

```swift
mutating func visitBlockQuote(_ blockQuote: BlockQuote) {
    if let (category, title) = detectGFMAlert(blockQuote) {
        emitAlertOpen(category)
        emitAlertTitle(category, title)
        // Skip first paragraph; visit remaining children
        for child in blockQuote.children.dropFirst() {
            visit(child)
        }
        result += "</blockquote>\n"
    } else if let (category, title, content) = detectDocCAlert(blockQuote) {
        emitAlertOpen(category)
        emitAlertTitle(category, title)
        for block in content {
            visit(block)
        }
        result += "</blockquote>\n"
    } else {
        result += "<blockquote>\n"
        descendInto(blockQuote)
        result += "</blockquote>\n"
    }
}
```

Note: `visit()` is a `MarkupWalker` method that dispatches to the correct
`visit*` override based on the node's dynamic type.


## Step 6 — CSS in `mud-up.css`

Add after the blockquote rules (~line 135). Structure:

1. Define `--alert-*` custom properties on `.alert` (light defaults).
2. Override them inside `@media (prefers-color-scheme: dark)`.
3. Base `.alert` rule: reset `color` to `--text-color`, keep padding.
4. `.alert-title`: flexbox row, `font-weight: 600`, icon sizing via SVG
   `width`/ `height`, small gap.
5. Five category rules (`.alert-note` through `.alert-caution`): each sets
   `border-left-color` and `.alert-title { color }` from the variables.

Color palette (light / dark):

| Category  | Light border | Light title | Dark border | Dark title |
| --------- | ------------ | ----------- | ----------- | ---------- |
| note      | #0969da      | #0969da     | #4493f8     | #4493f8    |
| tip       | #1a7f37      | #1a7f37     | #3fb950     | #3fb950    |
| important | #8250df      | #8250df     | #ab7df8     | #ab7df8    |
| warning   | #9a6700      | #9a6700     | #d29922     | #d29922    |
| caution   | #d1242f      | #d1242f     | #f85149     | #f85149    |

These are GitHub's own alert colors. Themes can override any `--alert-*`
variable in their `:root` blocks.


## Step 7 — Update `Doc/AGENTS.md`

No new files are added, but note the alert feature in the rendering pipeline
section or file quick reference if appropriate.


## Verification

Open `Doc/Examples/alerts.md` in Mud and verify:

1. All five GFM alerts render with correct border color, icon, and title.
2. DocC asides render with correct category styling and kind-specific titles.
3. Rich content (bold, code, links, code blocks, lists) renders inside alerts.
4. Plain blockquotes (no recognised tag) are unchanged.
5. Light/dark toggle works for alert colors.
6. All four themes display alerts consistently.
7. Down mode shows raw source unchanged.
8. CLI output (`mud -u`) includes alert HTML.

